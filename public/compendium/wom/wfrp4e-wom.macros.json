{
	"label": "Макрос (Ветра магии)",
	"entries": {
		"Generate Random Grimoire": {
			"name": "Создать случайный гримуар",
			"command": "let type = game.wfrp4e.tables.findTable(\"random-grimoire\", \"type\")\n        let spells = game.wfrp4e.tables.findTable(\"random-grimoire\", \"spells\")\n        let cn = game.wfrp4e.tables.findTable(\"random-grimoire\", \"cn\")\n        let lore = game.wfrp4e.tables.findTable(\"random-grimoire\", \"lore\")\n        let characteristic1 = game.wfrp4e.tables.findTable(\"random-grimoire\", \"characteristic1\")\n        let characteristic2 = game.wfrp4e.tables.findTable(\"random-grimoire\", \"characteristic2\")\n\n        let typeResult = (await type.roll()).results[0].text\n        let spellsResult = (await spells.roll()).results[0].text\n        let cnResult = (await cn.roll()).results[0].text\n        let loreResult = (await lore.roll()).results[0].text\n        let characteristic1Result = (await characteristic1.roll()).results[0].text\n        let characteristic2Result = (await characteristic2.roll()).results[0].text\n\n        let item = Item.implementation.create(\n            {\n                type: \"trapping\",\n                name: \"Grimoire\",\n                img: \"modules/wfrp4e-core/icons/equipment/book_documents/basic-book-magic.png\",\n                system: {\n                    trappingType: {\n                        value: \"booksAndDocuments\",\n                    },\n                    encumbrance : { value : 1},\n                    description: {\n                        value: `\n                        <p><strong>Type</strong>: ${typeResult}</p>\n                        <p><strong>Spells</strong>: ${spellsResult}</p>\n                        <p><strong>Max CN</strong>: ${cnResult}</p>\n                        <p><strong>Lore</strong>: ${loreResult}</p>\n                        <p>${characteristic1Result}</p>\n                        <p>${characteristic2Result}</p>\n                        `\n                    }\n                }\n            }, { renderSheet: true })",
			"description": "<p></p>"
		},
		"Generate Spell Scroll": {
			"name": "Создать свиток заклинания",
			"command": "let spells = await game.wfrp4e.utility.findAll(\"spell\")\n\n    let cnIndex = new Array(13).fill(undefined).map(i => [])\n\n    for(let spell of spells)\n    {\n        if (spell.system.cn.value <= 12)\n        {\n            cnIndex[spell.system.cn.value].push(spell)\n        }\n    }\n\n    let cnTable = game.wfrp4e.tables.findTable(\"scroll\", \"cn\")\n    let loreTable = game.wfrp4e.tables.findTable(\"scroll\", \"lore\")\n\n    let cn = Number((await cnTable.roll()).results[0].text)\n\n    let lore = (await loreTable.roll()).results[0].text\n\n    lore = Array.from(lore.matchAll(/{(.+?)}/gm))[0][1]\n\n    if (lore.includes(\"Chaos Magic\"))\n    {\n        lore = [\"Tzeentch\", \"Nurgle\", \"Slaanesh\", \"Undivided\"][Math.floor(CONFIG.Dice.randomUniform() * 4)]\n    }\n\n    let spellsWithLore = []\n    let searchCN = cn\n    while (spellsWithLore.length == 0)\n    {\n        let spellsWithCN = cnIndex[searchCN]\n        if (lore == \"Arcane\")\n        {\n            spellsWithLore = spellsWithCN.filter(i => !i.system.lore.value)\n        }\n        else \n            spellsWithLore = spellsWithCN.filter(i => game.wfrp4e.config.magicLores[i.system.lore.value] == lore)\n\n        if (searchCN == 0)\n            break;\n        else searchCN--\n    }\n\n\n    if (spellsWithLore.length > 0)\n    {\n        let selectedSpell = spellsWithLore[Math.floor(CONFIG.Dice.randomUniform() * spellsWithLore.length)]\n        let item = Item.implementation.create(\n            {\n                type : \"trapping\", \n                name : \"Scroll of \" + selectedSpell.name, \n                img : selectedSpell.img,\n                system : {\n                    trappingType : {\n                        value : \"booksAndDocuments\",\n                    },\n                    description : {\n                        value : `<p>@UUID[${selectedSpell.uuid}]</p>`\n                    }\n                }}, {renderSheet : true})\n    }\n    else \n    {\n        ui.notifications.notify(`Could not find ${lore} spell: CN ${cn} or lower. Try Again`)\n    }",
			"description": "<p></p>"
		}
	}
}
